<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="../assets/css/styles.css">
    <title>Profile</title>
</head>

<body>
    <header class="header-viewAppointments">
        <div class="sidebar-menu-btn" id="menu-btn">
            <img src="../assets/images/menu-logo.png" alt="">
            <div class="category-name"><h1 >PROFILE</h1></div>
        </div>
        <div class="selection">
            <a href="#"><img src="../assets/images/search-icon.png" class="search"></a> 
            <a href="../Student Side/notification.html"><img src="../assets/images/notif-icon.png" class="notif"></a>
            <div class="dropdown">
                <a class="user-dropdown-btn"><img src="../assets/images/user-icon.png" class="user"></a>
                <div class="dropdown-content">
                    <a href="../General/index.html">Log Out</a>
                    <a href="../Student Side/change-password.html">Change Password</a>
                </div>
            </div> 
        </div>
    </header>
    <div class="sidebar">
        <div class="top">
            <div class="sidebar-logo">
                <img src="../assets/images/TUP AS LOGO.png" alt="logo">
            </div>
            <p class="user-info" id="sidebar-user-name"></p>
        </div>
        <div class="menu-items">
            <ul>
                <li><a href="../Student Side/view-appointments.html">Home</a></li>
                <li><a href="../Student Side/book-appointment.html">Book Appointment</a></li>
                <li><a href="../Student Side/profile.html">Profile</a></li>
            </ul>
        </div>
    </div>

    <div class="main-view">
        <div class="cont">
            <p class="upcoming">Profile</p>
            <hr class="divider-view">
            <div class="user-profile"> 
                    <div class="student">
                        <img src="../assets/images/abby pic.png">
                    </div>
               <div class="user-profile-container">   
                        <div class="user-profile-container1">
                        <div class="user-label" >First Name</div>
                        <input type="text" class="user-field" placeholder="" id="firstName" name="firstName">
                    </div>

                    <div class="user-profile-container1">
                        <div class="user-label" >Middle Name</div>
                        <input type="text" class="user-field" placeholder="" id="middleName" name="middleName">
                    </div>

                    <div class="user-profile-container1">
                        <div class="user-label" >Last Name</div>
                        <input type="text" class="user-field" placeholder="" id="lastName" name="lastName">
                    </div>
                </div>       
           </div> 
           <div class="user-profile">
                <div class="user-profile-container"> 
                    <div class="user-profile-container1">
                        <div class="user-label" >Sex </div>
                        <input type="text" class="user-field" placeholder="" id="sex" name="sex">
                    </div>

                    <div class="user-profile-container1">
                        <div class="user-label" >Date of Birth</div>
                        <input type="text" class="user-field" placeholder="" id="birthDate" name="birthDate">
                    </div>

                    <div class="user-profile-container1">
                        <div class="user-label" >Age</div>
                        <input type="text" class="user-field" placeholder="" id="age" name="age">
                    </div>
                </div>       
            </div> 

            <div class="user-profile">
                <div class="user-profile-container"> 
                    <div class="user-profile-container1">
                        <div class="user-label" >Contact Number </div>
                        <input type="text" class="user-field" placeholder="" id="contactNumber" name="contactNumber">
                    </div>

                    <div class="user-profile-container1">
                        <div class="user-label" >Present Address</div>
                        <input type="text" class="user-field" placeholder="" id="address" name="address">
                    </div>  
                </div>       
            </div> 

           <div class="user-profile">
            <div class="user-profile-container"> 
                <div class="user-profile-container1">

                    <div class="user-label">Student Type</div>
                    <select class="user-field" id="studentType" name="studentType" required>
                        <option value="" disabled selected>Select Student Type</option>
                        <option value="undergraduate">Undergraduate</option>
                        <option value="graduate">Graduate</option>
                        <option value="doctorate">Doctorate</option>
                        <option value="alumni">Alumni</option>
                    </select>
                </div>

                <div class="user-profile-container1">
                    <div class="user-label" >TUP ID</div>
                    <input type="text" class="user-field" placeholder="" id="tupID" name="tupID">
                </div>

                <div class="user-profile-container1">
                    <div class="user-label" >Course</div>
                    <input type="text" class="user-field" placeholder="" id="course" name="course">
                </div>

                <div class="user-profile-container1">
                    <div class="user-label" >Year and Section</div>
                    <input type="text" class="user-field" placeholder="" id="yearSection" name="yearSection">
                </div>
            </div>       
            </div>
          
                 <div class="UpdateBtn" id="updateBtn">
                    <div><a><button>UPDATE</button></a></div>
                </div>   
        </div>
    </div>

    <script>
        // // Get form data from localStorage
        // const formData = JSON.parse(localStorage.getItem('formData'));
    
        // // Populate fields in booking-confirmation.html with form data
        // document.getElementById('firstName').value = formData.firstName;
        // document.getElementById('middleName').value = formData.middleName;
        // document.getElementById('lastName').value = formData.lastName;
        // document.getElementById('studentType').value = formData.studentType;
        // document.getElementById('tupID').value = formData.tupID;
        // document.getElementById('course').value = formData.course;
        // document.getElementById('yearSection').value = formData.yearSection;

        // Retrieve TUP ID from localStorage
        const tupID = localStorage.getItem('tupID');
        // console.log(tupID);

        fetch(`/profile?tupID=${tupID}`)
        .then(response => response.json())
        .then(data => {
            // console.log(data);
            document.getElementById('sidebar-user-name').textContent = data.firstName;
            document.getElementById('main-user-name').textContent = data.firstName;
        })
        .catch(error => console.error('Error:', error));
        
        // const password = localStorage.getItem('password');
        // console.log(password);

        // Use TUP ID to fetch user's profile
        fetch(`/profile?tupID=${tupID}`)
        .then(response => response.json())
        .then(data => {
            // console.log(data);
            document.getElementById('firstName').value = data.firstName;
            document.getElementById('middleName').value = data.middleName;
            document.getElementById('lastName').value = data.lastName;
            document.getElementById('sex').value = data.sex;
            document.getElementById('birthDate').value = data.birthDate;
            document.getElementById('age').value = data.age;
            document.getElementById('contactNumber').value = data.contactNumber;
            document.getElementById('address').value = data.address;
            document.getElementById('studentType').value = data.studentType;
            document.getElementById('tupID').value = data.tupID;
            document.getElementById('course').value = data.course;
            document.getElementById('yearSection').value = data.yearSection;
        })
        .catch(error => console.error('Error:', error));

        const updateProfile = () => {
            const updatedProfile = {
                firstName: document.getElementById('firstName').value,
                middleName: document.getElementById('middleName').value,
                lastName: document.getElementById('lastName').value,
                sex: document.getElementById('sex').value,
                birthDate: document.getElementById('birthDate').value,
                age: document.getElementById('age').value,
                contactNumber: document.getElementById('contactNumber').value,
                address: document.getElementById('address').value,
                studentType: document.getElementById('studentType').value,
                tupID: document.getElementById('tupID').value,
                course: document.getElementById('course').value,
                yearSection: document.getElementById('yearSection').value
            };

            fetch('/updateProfile', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(updatedProfile)
            })
            .then(response => response.json())
            .then(data => {
                // console.log(data);
                alert(data.message); // Show success or error message
            })
            .catch(error => console.error('Error:', error));
        };

        document.getElementById('updateBtn').addEventListener('click', updateProfile);
    </script>    
    
    <script type="text/javascript" src="../assets/js/script.js"></script>
</body>
</html>